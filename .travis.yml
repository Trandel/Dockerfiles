language: bash
services: docker

env:
  - DOCKER_REPO=webdevops-wordpress

install:
  - ls
  # - git clone https://github.com/docker-library/official-images.git ~/official-images

before_script:
  - TOKEN=$( curl -sSLd "username=${DOCKER_HUB_USERNAME}&password=${DOCKER_HUB_PASSWORD}" https://hub.docker.com/v2/users/login | jq -r '.token' )
  - NEW_TAG=$( curl -fsSL 'http://api.wordpress.org/core/version-check/1.7/' | jq -r '.offers[0].current' )
  - SHA1=$( curl -fsSL "https://wordpress.org/wordpress-${NEW_TAG}.tar.gz.sha1" )
  - "CURRENT_TAG=$( curl -sH \"Authorization: JWT ${TOKEN}\" \"https://hub.docker.com/v2/repositories/${DOCKER_HUB_USERNAME}/${DOCKER_REPO}/tags/latest/\" | jq -r '.name' )"

script:
  - if [ $NEW_TAG = $CURRENT_TAG ]; then
      echo "Nothing new to build";
    else
      echo "Start building new image";
    fi
  # - travis_retry docker build -t "$image" .

after_script:
  - docker images

# vim:set et ts=2 sw=2:
